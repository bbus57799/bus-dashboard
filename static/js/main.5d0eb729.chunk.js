(this["webpackJsonpbus-dashboard"]=this["webpackJsonpbus-dashboard"]||[]).push([[0],{38:function(e){e.exports=JSON.parse('{"api_url":"https://bus-dashboard-api.herokuapp.com","overcrowded_threshold":50}')},72:function(e,t,n){},97:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),s=n(37),c=n.n(s),i=(n(72),n(11)),o=n.n(i),l=n(14),u=n(17),d=n(18),h=n(20),j=n(19),b=n(10),p=n(40);n(74),n(98);p.a.initializeApp({apiKey:"AIzaSyD1HWzM2Ac2U0Se2upiCxvF9yKGrFe_YJY",authDomain:"bus-dashboard-12aad.firebaseapp.com",projectId:"bus-dashboard-12aad",storageBucket:"bus-dashboard-12aad.appspot.com",messagingSenderId:"1024758108522",appId:"1:1024758108522:web:565d31143af7a5259a9513",measurementId:"G-L21M94PQ90"});var O=p.a.auth(),m=p.a.firestore(),v=n(38),x=n(2),f=Object(a.createContext)({user:null,initialized:!1,login:void 0,logout:void 0,signup:void 0,updateUser:void 0}),g=function(e){return function(t){return Object(x.jsx)(f.Consumer,{children:function(n){return Object(x.jsx)(e,Object(b.a)(Object(b.a)({},t),{},{authInfo:n}))}})}},y=function(e){Object(h.a)(n,e);var t=Object(j.a)(n);function n(){var e;Object(u.a)(this,n);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).authUnsubscriber=null,e.userDocUnsubscriber=null,e.state={initialized:!1,user:null},e.login=function(){var e=Object(l.a)(o.a.mark((function e(t,n,a){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!a){e.next=5;break}return e.next=3,O.setPersistence(p.a.auth.Auth.Persistence.LOCAL);case 3:e.next=7;break;case 5:return e.next=7,O.setPersistence(p.a.auth.Auth.Persistence.SESSION);case 7:return e.next=9,O.signInWithEmailAndPassword(t,n);case 9:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),e.signup=function(){var e=Object(l.a)(o.a.mark((function e(t){var n,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O.currentUser.getIdToken();case 2:return n=e.sent,e.next=5,fetch("".concat(v.api_url,"/users"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Object(b.a)(Object(b.a)({},t),{},{token:n}))});case 5:if(!((a=e.sent).status<200||a.status>=300)){e.next=10;break}return e.next=9,a.json();case 9:throw e.sent;case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.updateUser=function(){var e=Object(l.a)(o.a.mark((function e(t,n){var a,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O.currentUser.getIdToken();case 2:return a=e.sent,e.next=5,fetch("".concat(v.api_url,"/users/").concat(t),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(Object(b.a)(Object(b.a)({},n),{},{token:a}))});case 5:if(!((r=e.sent).status<200||r.status>=300)){e.next=10;break}return e.next=9,r.json();case 9:throw e.sent;case 10:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),e.logout=Object(l.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O.signOut();case 2:case"end":return e.stop()}}),e)}))),e}return Object(d.a)(n,[{key:"componentDidMount",value:function(){var e=this;this.authUnsubscriber=O.onAuthStateChanged((function(t){var n;(null===(n=e.state.user)||void 0===n?void 0:n.uid)!==(null===t||void 0===t?void 0:t.uid)&&e.userDocUnsubscriber&&(e.userDocUnsubscriber(),e.userDocUnsubscriber=null),t?e.userDocUnsubscriber=m.collection("users").doc(t.uid).onSnapshot((function(t){t.exists&&e.setState({user:t.data(),initialized:!0})})):e.setState({user:null,initialized:!0})}))}},{key:"componentWillUnmount",value:function(){this.authUnsubscriber&&this.authUnsubscriber(),this.userDocUnsubscriber&&this.userDocUnsubscriber()}},{key:"render",value:function(){var e={initialized:this.state.initialized,user:this.state.user,login:this.login,logout:this.logout,signup:this.signup,updateUser:this.updateUser};return Object(x.jsx)(f.Provider,{value:e,children:this.props.children})}}]),n}(a.Component),C=n(106),k=n(102),w=n(105),S=n(103),U=n(28),N=n(104),D=n(100);function I(e){if(console.log("Error Occured: ",e),null===e||void 0===e?void 0:e.code)switch(e.code){case"auth/user-not-found":case"auth/wrong-password":return"Invalid email or password.";case"auth/email-already-exists":return"The email address is already in use by another user.";case"auth/invalid-password":return e.message}return"Error happened"}var B=function(e){Object(h.a)(n,e);var t=Object(j.a)(n);function n(){var e;Object(u.a)(this,n);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).state={email:"",password:"",rememberMe:!0,error:"",isLoading:!1},e.onSubmit=function(){var t=Object(l.a)(o.a.mark((function t(n){var a,r;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n.preventDefault(),n.stopPropagation(),a=e.props.onLogin,e.setState({isLoading:!0,error:""}),t.prev=4,t.next=7,a(e.state.email,e.state.password,e.state.rememberMe);case 7:t.next=13;break;case 9:t.prev=9,t.t0=t.catch(4),r=I(t.t0),e.setState({error:r});case 13:e.setState({isLoading:!1});case 14:case"end":return t.stop()}}),t,null,[[4,9]])})));return function(e){return t.apply(this,arguments)}}(),e.handleChange=function(t){return function(n){var a,r=n.target.value;return e.setState((a={},Object(U.a)(a,t,r),Object(U.a)(a,"error",""),a))}},e.handleCheck=function(t){return function(n){var a=n.target.checked;return e.setState(Object(U.a)({},t,a))}},e}return Object(d.a)(n,[{key:"render",value:function(){return Object(x.jsxs)(N.a,{onSubmit:this.onSubmit,children:[Object(x.jsxs)(N.a.Group,{controlId:"formBasicEmail",children:[Object(x.jsx)(N.a.Label,{children:"Email address"}),Object(x.jsx)(N.a.Control,{type:"email",placeholder:"Enter email",onChange:this.handleChange("email"),value:this.state.email,required:!0}),Object(x.jsx)(N.a.Text,{className:"text-muted",children:"We'll never share your email with anyone else."})]}),Object(x.jsxs)(N.a.Group,{controlId:"formBasicPassword",children:[Object(x.jsx)(N.a.Label,{children:"Password"}),Object(x.jsx)(N.a.Control,{type:"password",placeholder:"Password",value:this.state.password,onChange:this.handleChange("password"),required:!0})]}),Object(x.jsx)(N.a.Group,{controlId:"formBasicCheckbox",children:Object(x.jsx)(N.a.Check,{type:"checkbox",onChange:this.handleCheck("rememberMe"),checked:this.state.rememberMe,label:"Remember Me"})}),Object(x.jsx)("p",{className:"text-danger",children:this.state.error}),Object(x.jsx)(D.a,{variant:"primary",type:"submit",disabled:this.state.isLoading,children:"Login"})]})}}]),n}(a.Component);var L=g((function(e){var t=e.authInfo;return Object(x.jsxs)(S.a,{size:"md",show:!0,"aria-labelledby":"contained-modal-title-vcenter",centered:!0,children:[Object(x.jsx)(S.a.Header,{children:Object(x.jsx)(S.a.Title,{id:"contained-modal-title-vcenter",children:"Login"})}),Object(x.jsx)(S.a.Body,{children:Object(x.jsx)(B,{onLogin:t.login})})]})})),A=n(32),P=n(12),M=n(27);var T=g((function(e){var t=e.children,n=e.authInfo,a=Object(M.a)(e,["children","authInfo"]);return Object(x.jsx)(P.b,Object(b.a)(Object(b.a)({},a),{},{render:function(){return n.user?Object(x.jsx)(P.a,{to:"/users"}):t}}))}));var E=g((function(e){var t=e.children,n=e.authInfo,a=Object(M.a)(e,["children","authInfo"]);return Object(x.jsx)(P.b,Object(b.a)(Object(b.a)({},a),{},{render:function(){return n.user?t:Object(x.jsx)(P.a,{to:"/login"})}}))})),z=n(52),G=n.n(z),R=n(101);var W=Object(P.g)((function(e){var t=e.buses,n=e.history;return Object(x.jsxs)(R.a,{striped:!0,bordered:!0,hover:!0,children:[Object(x.jsx)("thead",{children:Object(x.jsxs)("tr",{children:[Object(x.jsx)("th",{children:"ID"}),Object(x.jsx)("th",{children:"Bus Name"}),Object(x.jsx)("th",{children:"Count"}),Object(x.jsx)("th",{children:"Highest Today"}),Object(x.jsx)("th",{children:"Driver Name"})]})}),Object(x.jsx)("tbody",{children:t&&t.map((function(e){return Object(x.jsxs)("tr",{className:e.count>v.overcrowded_threshold||e.highestCountToday>v.overcrowded_threshold?"table-danger":"",role:"button",onClick:function(){return n.push("/buses/".concat(e.id))},children:[Object(x.jsx)("td",{children:e.id}),Object(x.jsx)("td",{children:e.name}),Object(x.jsx)("td",{children:e.count}),Object(x.jsx)("td",{children:e.highestCountToday}),Object(x.jsx)("td",{children:e.driverName})]},e.id)}))})]})})),H=n(107),_=function(e){Object(h.a)(n,e);var t=Object(j.a)(n);function n(){var e;Object(u.a)(this,n);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).state={key:"",value:""},e.onSubmit=function(t){t.preventDefault(),t.stopPropagation(),e.props.onSearch(e.state)},e}return Object(d.a)(n,[{key:"render",value:function(){var e=this;return Object(x.jsx)(H.a,{children:Object(x.jsx)(H.a.Body,{children:Object(x.jsxs)(N.a,{onSubmit:this.onSubmit,inline:!0,className:"align-items-baseline",children:[Object(x.jsx)(N.a.Label,{className:"mx-2",children:"Search By: "}),Object(x.jsxs)(N.a.Control,{onChange:function(t){return e.setState({key:t.target.value})},value:this.state.key,as:"select",className:"my-1 mr-sm-2",custom:!0,children:[Object(x.jsx)("option",{value:"",children:"Choose..."}),Object(x.jsx)("option",{value:"id",children:"Bus ID"}),Object(x.jsx)("option",{value:"name",children:"Bus Name"}),Object(x.jsx)("option",{value:"driver",children:"Driver Name"}),Object(x.jsx)("option",{value:"overcrowded",children:"Only Overcrowded"})]}),Object(x.jsx)(N.a.Control,{onChange:function(t){return e.setState({value:t.target.value})},disabled:"overcrowded"===this.state.key,className:"mb-2 mr-sm-2",placeholder:"What to search"}),Object(x.jsx)(D.a,{type:"submit",className:"mb-2 mx-1",children:"Search"}),Object(x.jsx)(D.a,{onClick:this.props.onReset,className:"mb-2",children:"Reset"})]})})})}}]),n}(a.Component),F=function(e){Object(h.a)(n,e);var t=Object(j.a)(n);function n(){var e;Object(u.a)(this,n);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).state={id:"",name:"",driverName:"",isLoading:!1,error:""},e.onSubmit=function(){var t=Object(l.a)(o.a.mark((function t(n){var a,r;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n.preventDefault(),n.stopPropagation(),a=e.props.onSubmit,e.setState({isLoading:!0,error:""}),t.prev=4,t.next=7,a(e.state);case 7:t.next=13;break;case 9:t.prev=9,t.t0=t.catch(4),r=I(n),e.setState({error:r});case 13:e.setState({isLoading:!1});case 14:case"end":return t.stop()}}),t,null,[[4,9]])})));return function(e){return t.apply(this,arguments)}}(),e.handleChange=function(t){return function(n){var a,r=n.target.value;return e.setState((a={},Object(U.a)(a,t,r),Object(U.a)(a,"error",""),a))}},e}return Object(d.a)(n,[{key:"componentDidMount",value:function(){this.setState(Object(b.a)({},this.props.busInfo))}},{key:"render",value:function(){return Object(x.jsxs)(N.a,{onSubmit:this.onSubmit,children:[Object(x.jsxs)(N.a.Group,{children:[Object(x.jsx)(N.a.Label,{children:"ID"}),Object(x.jsx)(N.a.Control,{type:"text",placeholder:"Bus ID",value:this.state.id,disabled:this.props.readOnlyId,onChange:this.handleChange("id"),required:!0})]}),Object(x.jsxs)(N.a.Group,{children:[Object(x.jsx)(N.a.Label,{children:"Bus Name"}),Object(x.jsx)(N.a.Control,{type:"text",placeholder:"Enter bus name",onChange:this.handleChange("name"),value:this.state.name})]}),Object(x.jsxs)(N.a.Group,{children:[Object(x.jsx)(N.a.Label,{children:"Driver Name"}),Object(x.jsx)(N.a.Control,{type:"text",placeholder:"Enter driver name",onChange:this.handleChange("driverName"),value:this.state.driverName})]}),Object(x.jsx)("p",{className:"text-danger",children:this.state.error}),Object(x.jsx)(D.a,{variant:"primary",type:"submit",disabled:this.state.isLoading,children:"Save"}),Object(x.jsx)(D.a,{onClick:this.props.onClose,className:"mx-1",variant:"secondary",children:"Close"})]})}}]),n}(a.Component);var q=function(e){e.authInfo;var t=e.onClose,n=Object(M.a)(e,["authInfo","onClose"]),a=function(){var e=Object(l.a)(o.a.mark((function e(n){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.collection("buses").doc(n.id).set({name:n.name,driverName:n.driverName});case 2:t();case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(x.jsxs)(S.a,Object(b.a)(Object(b.a)({onHide:t,size:"md","aria-labelledby":"contained-modal-title-vcenter",centered:!0},n),{},{children:[Object(x.jsx)(S.a.Header,{closeButton:!0,children:Object(x.jsx)(S.a.Title,{id:"contained-modal-title-vcenter",children:"Add a bus"})}),Object(x.jsx)(S.a.Body,{children:Object(x.jsx)(F,{onSubmit:a,onClose:t})})]}))},J=function(e){Object(h.a)(n,e);var t=Object(j.a)(n);function n(){var e;Object(u.a)(this,n);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).state={key:"",value:"",showBusModal:!1},e.searchUnsubscriber=null,e.fetchBuses=function(){var t=G.a.parse(e.props.location.search),n=m.collection("buses");"overcrowded"===t.key?n=n.where("highestCountToday",">=",v.overcrowded_threshold):t.key&&t.value&&(n=n.where(t.key,">=",t.value).where(t.key,"<=",t.value+"\uf8ff")),e.searchUnsubscriber=n.onSnapshot((function(t){e.setState({buses:t.docs.map((function(e){return Object(b.a)(Object(b.a)({},e.data()),{},{id:e.id})}))})}))},e.closeBusModal=function(){e.setState({showBusModal:!1})},e.openBusModal=function(){e.setState({showBusModal:!0})},e}return Object(d.a)(n,[{key:"componentDidMount",value:function(){this.fetchBuses()}},{key:"componentDidUpdate",value:function(e,t){var n,a;(null===(n=this.props.location)||void 0===n?void 0:n.search)!==(null===(a=e.location)||void 0===a?void 0:a.search)&&this.fetchBuses()}},{key:"componentWillUnmount",value:function(){this.searchUnsubscriber&&this.searchUnsubscriber()}},{key:"render",value:function(){var e=this;return Object(x.jsxs)(k.a,{className:"my-2",children:[Object(x.jsx)(q,{onClose:this.closeBusModal,show:this.state.showBusModal}),Object(x.jsx)(_,{onSearch:function(t){return e.props.history.push("/?key=".concat(t.key,"&value=").concat(t.value))},onReset:function(){return e.props.history.push("/")}}),Object(x.jsx)("div",{className:"d-flex",children:Object(x.jsx)(D.a,{className:"m-1",onClick:this.openBusModal,children:"+ New Bus"})}),Object(x.jsx)(W,{buses:this.state.buses})]})}}]),n}(a.Component),Y=Object(P.g)(J),K=function(e){Object(h.a)(n,e);var t=Object(j.a)(n);function n(){var e;Object(u.a)(this,n);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).state={key:"",value:""},e.onSubmit=function(t){t.preventDefault(),t.stopPropagation(),e.props.onSearch(e.state)},e}return Object(d.a)(n,[{key:"render",value:function(){var e=this;return Object(x.jsx)(H.a,{children:Object(x.jsx)(H.a.Body,{children:Object(x.jsxs)(N.a,{onSubmit:this.onSubmit,inline:!0,className:"align-items-baseline",children:[Object(x.jsx)(N.a.Label,{className:"mx-2",children:"Search By: "}),Object(x.jsxs)(N.a.Control,{onChange:function(t){return e.setState({key:t.target.value})},value:this.state.key,as:"select",className:"my-1 mr-sm-2",custom:!0,children:[Object(x.jsx)("option",{value:"",children:"Choose..."}),Object(x.jsx)("option",{value:"name",children:"User Name"}),Object(x.jsx)("option",{value:"phone",children:"Phone"}),Object(x.jsx)("option",{value:"email",children:"Email"})]}),Object(x.jsx)(N.a.Control,{onChange:function(t){return e.setState({value:t.target.value})},className:"mb-2 mr-sm-2",placeholder:"What to search"}),Object(x.jsx)(D.a,{type:"submit",className:"mb-2 mx-1",children:"Search"}),Object(x.jsx)(D.a,{onClick:this.props.onReset,className:"mb-2",children:"Reset"})]})})})}}]),n}(a.Component);var Q=function(e){var t=e.users,n=e.onSelected;return Object(x.jsxs)(R.a,{striped:!0,bordered:!0,hover:!0,children:[Object(x.jsx)("thead",{children:Object(x.jsxs)("tr",{children:[Object(x.jsx)("th",{children:"#"}),Object(x.jsx)("th",{children:"User Name"}),Object(x.jsx)("th",{children:"Email"}),Object(x.jsx)("th",{children:"Phone"}),Object(x.jsx)("th",{children:"Role"})]})}),Object(x.jsx)("tbody",{children:t&&t.map((function(e,t){return Object(x.jsxs)("tr",{role:"button",onClick:function(){return n(e)},children:[Object(x.jsx)("td",{children:t+1}),Object(x.jsx)("td",{children:e.name}),Object(x.jsx)("td",{children:e.email}),Object(x.jsx)("td",{children:e.phone}),Object(x.jsx)("td",{children:e.role})]},e.id)}))})]})},V=function(e){Object(h.a)(n,e);var t=Object(j.a)(n);function n(){var e;Object(u.a)(this,n);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).state={name:"",email:"",password:"",phone:"",role:"normal",isLoading:!1,error:""},e.onSubmit=function(){var t=Object(l.a)(o.a.mark((function t(n){var a,r;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n.preventDefault(),n.stopPropagation(),a=e.props.onSubmit,e.setState({isLoading:!0,error:""}),t.prev=4,t.next=7,a(e.state);case 7:t.next=13;break;case 9:t.prev=9,t.t0=t.catch(4),r=I(t.t0),e.setState({error:r});case 13:e.setState({isLoading:!1});case 14:case"end":return t.stop()}}),t,null,[[4,9]])})));return function(e){return t.apply(this,arguments)}}(),e.handleChange=function(t){return function(n){var a,r=n.target.value;return e.setState((a={},Object(U.a)(a,t,r),Object(U.a)(a,"error",""),a))}},e}return Object(d.a)(n,[{key:"componentWillMount",value:function(){this.props.initialData&&this.setState({name:this.props.initialData.name,email:this.props.initialData.email,phone:this.props.initialData.phone,role:this.props.initialData.role})}},{key:"render",value:function(){return Object(x.jsxs)(N.a,{onSubmit:this.onSubmit,children:[Object(x.jsxs)(N.a.Group,{children:[Object(x.jsx)(N.a.Label,{children:"Name"}),Object(x.jsx)(N.a.Control,{type:"text",placeholder:"User Name",value:this.state.name,onChange:this.handleChange("name"),required:!0})]}),Object(x.jsxs)(N.a.Group,{children:[Object(x.jsx)(N.a.Label,{children:"Email address"}),Object(x.jsx)(N.a.Control,{type:"email",placeholder:"Enter email",onChange:this.handleChange("email"),value:this.state.email,required:!0})]}),Object(x.jsxs)(N.a.Group,{children:[Object(x.jsx)(N.a.Label,{children:"Phone"}),Object(x.jsx)(N.a.Control,{type:"phone",placeholder:"Enter phone",onChange:this.handleChange("phone"),value:this.state.phone})]}),Object(x.jsxs)(N.a.Group,{children:[Object(x.jsx)(N.a.Label,{children:"Password"}),Object(x.jsx)(N.a.Control,{type:"password",placeholder:"Password",value:this.state.password,onChange:this.handleChange("password"),required:!this.props.initialData})]}),Object(x.jsxs)(N.a.Group,{children:[Object(x.jsx)(N.a.Label,{children:"Role"}),Object(x.jsxs)(N.a.Control,{onChange:this.handleChange("role"),value:this.state.role,as:"select",children:[Object(x.jsx)("option",{value:"normal",children:"Normal User"}),Object(x.jsx)("option",{value:"admin",children:"Admin"})]})]}),Object(x.jsx)("p",{className:"text-danger",children:this.state.error}),Object(x.jsx)(D.a,{variant:"primary",type:"submit",disabled:this.state.isLoading,children:"Save"}),Object(x.jsx)(D.a,{onClick:this.props.onClose,className:"mx-1",variant:"secondary",children:"Close"})]})}}]),n}(a.Component);var X=g((function(e){var t=e.authInfo,n=e.onClose,a=Object(M.a)(e,["authInfo","onClose"]),r=function(){var e=Object(l.a)(o.a.mark((function e(a){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.signup(a);case 2:n();case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(x.jsxs)(S.a,Object(b.a)(Object(b.a)({onHide:n,size:"md","aria-labelledby":"contained-modal-title-vcenter",centered:!0},a),{},{children:[Object(x.jsx)(S.a.Header,{closeButton:!0,children:Object(x.jsx)(S.a.Title,{id:"contained-modal-title-vcenter",children:"Create a user"})}),Object(x.jsx)(S.a.Body,{children:Object(x.jsx)(V,{onSubmit:r,onClose:n})})]}))}));var Z=g((function(e){var t=e.authInfo,n=e.userInfo,a=e.onClose,r=Object(M.a)(e,["authInfo","userInfo","onClose"]),s=function(){var e=Object(l.a)(o.a.mark((function e(r){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.updateUser(n.id,r);case 2:a();case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(x.jsxs)(S.a,Object(b.a)(Object(b.a)({onHide:a,size:"md","aria-labelledby":"contained-modal-title-vcenter",centered:!0},r),{},{children:[Object(x.jsx)(S.a.Header,{closeButton:!0,children:Object(x.jsx)(S.a.Title,{id:"contained-modal-title-vcenter",children:"Update a user"})}),Object(x.jsx)(S.a.Body,{children:Object(x.jsx)(V,{initialData:n,onSubmit:s,onClose:a})})]}))})),$=function(e){Object(h.a)(n,e);var t=Object(j.a)(n);function n(){var e;Object(u.a)(this,n);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).state={key:"",value:"",showAddUser:!1,selectedUser:null},e.searchUnsubscriber=null,e.fetchUsers=function(){var t=G.a.parse(e.props.location.search),n=m.collection("users");t.key&&t.value&&(n=n.where(t.key,">=",t.value).where(t.key,"<=",t.value+"\uf8ff").orderBy(t.key)),n=n.orderBy("created_at","desc"),e.searchUnsubscriber=n.onSnapshot((function(t){e.setState({users:t.docs.map((function(e){return Object(b.a)(Object(b.a)({},e.data()),{},{id:e.id})}))})}))},e.onUserClicked=function(t){e.setState({selectedUser:t})},e}return Object(d.a)(n,[{key:"componentDidMount",value:function(){this.fetchUsers()}},{key:"componentDidUpdate",value:function(e,t){var n,a;(null===(n=this.props.location)||void 0===n?void 0:n.search)!==(null===(a=e.location)||void 0===a?void 0:a.search)&&this.fetchUsers()}},{key:"componentWillUnmount",value:function(){this.searchUnsubscriber&&this.searchUnsubscriber()}},{key:"render",value:function(){var e=this;return Object(x.jsxs)(k.a,{className:"my-2",children:[Object(x.jsx)(X,{show:this.state.showAddUser,onClose:function(){return e.setState({showAddUser:!1})}}),this.state.selectedUser&&Object(x.jsx)(Z,{userInfo:this.state.selectedUser,show:!0,onClose:function(){return e.setState({selectedUser:null})}}),Object(x.jsx)(K,{onSearch:function(t){return e.props.history.push("/users?key=".concat(t.key,"&value=").concat(t.value))}}),Object(x.jsx)("div",{className:"d-flex",children:Object(x.jsx)(D.a,{className:"m-1",onClick:function(){return e.setState({showAddUser:!0})},children:"+ New User"})}),Object(x.jsx)(Q,{onSelected:this.onUserClicked,users:this.state.users})]})}}]),n}(a.Component),ee=Object(P.g)($);var te=function(e){var t=e.readings;return Object(x.jsxs)(R.a,{striped:!0,bordered:!0,hover:!0,children:[Object(x.jsx)("thead",{children:Object(x.jsxs)("tr",{children:[Object(x.jsx)("th",{children:"#"}),Object(x.jsx)("th",{children:"Time"}),Object(x.jsx)("th",{children:"Count"})]})}),Object(x.jsx)("tbody",{children:t&&t.map((function(e,t){return Object(x.jsxs)("tr",{role:"button",children:[Object(x.jsx)("td",{children:t+1}),Object(x.jsx)("td",{children:e.createdAt.toDate().toLocaleString()}),Object(x.jsx)("td",{children:e.count})]},e.id)}))})]})},ne=function(e){var t="".concat(e.getFullYear()).padStart(4,"0"),n="".concat(e.getMonth()).padStart(2,"0"),a="".concat(e.getDate()).padStart(2,"0");return"".concat(t,"-").concat(n,"-").concat(a)},ae=function(e){var t=e.split("-");return new Date(+t[0],+t[1],+t[2])},re=function(e){Object(h.a)(n,e);var t=Object(j.a)(n);function n(){var e;Object(u.a)(this,n);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).state={date:new Date((new Date).toDateString()),bus:null,readings:null},e.searchUnsubscriber=null,e.docUnsubscriber=null,e.fetchReadings=function(){var t=e.props.match.params.busId,n=new Date(e.state.date);n.setDate(n.getDate()+1);var a=m.collection("buses").doc("".concat(t)).collection("readings").where("createdAt",">=",e.state.date).where("createdAt","<",n);e.searchUnsubscriber=a.onSnapshot((function(t){e.setState({readings:t.docs.map((function(e){return Object(b.a)(Object(b.a)({},e.data()),{},{id:e.id})}))})})),e.docUnsubscriber=m.collection("buses").doc("".concat(t)).onSnapshot((function(t){e.setState({bus:Object(b.a)(Object(b.a)({},t.data()),{},{id:t.id})})}))},e.onUpdateBus=function(){var e=Object(l.a)(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.collection("buses").doc(t.id).update({name:t.name,driverName:t.driverName});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e}return Object(d.a)(n,[{key:"componentDidMount",value:function(){this.fetchReadings()}},{key:"componentDidUpdate",value:function(e,t){var n,a;(null===(n=this.props.match)||void 0===n?void 0:n.params)!==(null===(a=e.match)||void 0===a?void 0:a.params)&&this.fetchReadings()}},{key:"componentWillUnmount",value:function(){this.searchUnsubscriber&&this.searchUnsubscriber(),this.docUnsubscriber&&this.docUnsubscriber()}},{key:"render",value:function(){var e,t=this;return Object(x.jsxs)(k.a,{className:"my-2",children:[Object(x.jsx)(H.a,{className:"p-2 m-2",children:Object(x.jsxs)(N.a.Group,{children:[Object(x.jsx)(N.a.Label,{className:"mx-1",children:"Redings During:"}),Object(x.jsx)("input",{value:ne(this.state.date),onChange:function(e){t.setState({date:ae(e.target.value)},t.fetchReadings)},type:"date"})]})}),Object(x.jsx)(H.a,{className:"p-2 m-2",children:this.state.bus&&Object(x.jsx)(F,{onSubmit:this.onUpdateBus,onClose:this.props.history.goBack,readOnlyId:!0,busInfo:Object(b.a)({},this.state.bus)})}),Object(x.jsx)(H.a,{className:"p-2 m-2",children:Object(x.jsxs)("h3",{className:"text-center",children:["Current Count: ",null===(e=this.state.bus)||void 0===e?void 0:e.count]})}),Object(x.jsx)(te,{readings:this.state.readings})]})}}]),n}(a.Component),se=Object(P.g)(re);var ce=g((function(e){var t=e.children,n=e.authInfo,a=Object(M.a)(e,["children","authInfo"]);return Object(x.jsx)(P.b,Object(b.a)(Object(b.a)({},a),{},{render:function(){return n.user?"admin"===n.user.role?t:Object(x.jsx)(P.a,{to:"/"}):Object(x.jsx)(P.a,{to:"/login"})}}))}));var ie=g((function(e){var t=e.authInfo;return Object(x.jsx)("div",{children:Object(x.jsxs)(A.a,{children:[t.user&&Object(x.jsx)(C.a,{bg:"dark",variant:"dark",children:Object(x.jsxs)(k.a,{children:[Object(x.jsx)(A.b,{className:"navbar-brand",to:"/",children:"Bus Dashboard"}),Object(x.jsxs)(w.a,{className:"mr-auto",children:[Object(x.jsx)(A.b,{className:"nav-link",to:"/",children:"Buses"}),"admin"===t.user.role&&Object(x.jsx)(A.b,{className:"nav-link",to:"/users",children:"Users"})]}),Object(x.jsx)(w.a,{className:"mr-auto",children:Object(x.jsx)(A.b,{className:"nav-link",to:"",onClick:t.logout,children:"Logout"})})]})}),Object(x.jsxs)(P.d,{children:[Object(x.jsx)(T,{path:"/login",children:Object(x.jsx)(L,{})}),Object(x.jsx)(ce,{path:"/users",children:Object(x.jsx)(ee,{})}),Object(x.jsx)(E,{path:"/buses/:busId",children:Object(x.jsx)(se,{})}),Object(x.jsx)(E,{path:"/",children:Object(x.jsx)(Y,{})})]}),t.user&&Object(x.jsx)(C.a,{className:"justify-content-center",fixed:"bottom",bg:"dark",variant:"dark",children:Object(x.jsx)("span",{className:"text-light",children:"Bus Dashboard 2021"})})]})})}));var oe=g((function(e){return e.authInfo.initialized?Object(x.jsx)(ie,{}):Object(x.jsx)("div",{})}));var le=function(){return Object(x.jsx)(y,{children:Object(x.jsx)(oe,{})})},ue=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,108)).then((function(t){var n=t.getCLS,a=t.getFID,r=t.getFCP,s=t.getLCP,c=t.getTTFB;n(e),a(e),r(e),s(e),c(e)}))};n(96);c.a.render(Object(x.jsx)(r.a.StrictMode,{children:Object(x.jsx)(le,{})}),document.getElementById("root")),ue()}},[[97,1,2]]]);
//# sourceMappingURL=main.5d0eb729.chunk.js.map